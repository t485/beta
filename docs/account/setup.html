<!DOCTYPE html>

<html lang="en">

<head>
	
		<meta charset="utf-8">
		<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
		<meta content=" The official Boy Scout Troop 485 website. " name="description">
	
	 
	
		<title>Troop 485 - Login</title>
		
	

	
		<!-- Bootstrap core CSS -->
		<link href="/css/bootstrap.min.css" rel="stylesheet">
		<!-- Custom fonts for this template -->
		<link href="https://fonts.googleapis.com/css?family=Raleway:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i"
			rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i" rel="stylesheet">
		<!-- Custom styles for this template -->
		<link href="/css/theme.css" rel="stylesheet">
		<link href="/css/t485.css" rel="stylesheet">
	
	
		<!-- Favicons -->
		<link rel="apple-touch-icon" sizes="152x152" href="/favicons/apple-touch-icon-152x152.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon-180x180.png">
		<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
	
	
	
	
		<script>
			try {
				localStorage.setItem('firebaseErrorTest', 'test');
			}
			catch (e) {
				console.log(e)
				if (e.message === 'The quota has been exceeded.') {
					// using Safari(desktop & iOS) or Chrome(iOS) w/ private, localStorage not supported
					// firebase will throw error, so better to alert user now
					alert("Private browsing is not supported on Safari or the Chrome IOS app. " +
					"Turn off private browsing or use a supported private browsing app.");
				}
				throw 'notEnoughLocalStorage';
			}
		</script>
	
</head>

<body>
	
		<div class="text-center">
			<a href="/">
				<img src="/img/header.png" alt="Boy Scout Troop 485" id="header">
			</a>
		</div>
	
	
	

		<div id="alertBox">
		</div>
	
	
		<!-- Navigation -->


		<nav class="navbar navbar-expand-lg navbar-light py-lg-4" id="navbar">
			<div class="container">
				<a class="navbar-brand text-uppercase text-expanded font-weight-bold d-lg-none" href="/">Troop 485</a>
				<button aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"
						class="navbar-toggler"
					data-target="#navbarResponsive" data-toggle="collapse" type="button">
					<span class="navbar-toggler-icon"></span>
				</button>

				<div class="collapse navbar-collapse" id="navbarResponsive">
					<ul class="navbar-nav mx-auto">


						<li class="nav-item px-lg-4">
							<a class="nav-link text-uppercase text-expanded" href="/">Home</a>
						</li>

						<li class="nav-item px-lg-4">
							<a class="nav-link text-uppercase text-expanded" href="/calendar.html">Calendar</a>
						</li>
						<li class="nav-item px-lg-4">
							<a class="nav-link text-uppercase text-expanded" href="/directory.html">Directory</a>
						</li>
						<li class="nav-item px-lg-4">
							<a class="nav-link text-uppercase text-expanded" href="/event-pages.html">Event Pages</a>
						</li>
						<li class="nav-item px-lg-4">
							<a class="nav-link text-uppercase text-expanded" href="/pictures.html">Pictures</a>
						</li>




						<li class="nav-item dropdown px-lg-4">
							<a class="nav-link dropdown-toggle text-uppercase text-expanded"
							   data-toggle="dropdown" href="#" role="button">About</a>

							<div class="dropdown-menu">
								<a class="dropdown-item" href="/about/faq.html">FAQ</a>
								<a class="dropdown-item" href="/about/merit-badges.html">Merit Badges</a>
							</div>
						</li>
						<li class="nav-item dropdown px-lg-4">
							<a aria-expanded="false" aria-haspopup="true"
							   class="nav-link dropdown-toggle text-uppercase text-expanded" data-toggle="dropdown"
							   href="#" id="account-dropdown" role="button">Account</a>

							<div aria-labelledby="account-dropdown" class="dropdown-menu">
								<!-- acct-dd-status = ACCounT-DropDown-HeaDeR -->
								<!-- lo-show = logged out show, li-show = logged in show.
								lo-show is hidden when logged in, and vice versa --->
								<h6 class="dropdown-header" id="acct-dd-status">
									<span id="acct-dd-status-notloggedin" class="lo-show">You are not logged in.</span>
									<span id="acct-dd-status-loggedin" class="li-show hidden">Logged in as <b id="acct-dd-status-loggedin-username" class="user-displayname">loading...</b>.</span></h6>
								<a id="acct-dd-login-link" class="lo-show dropdown-item preserve-page" href="/account/login.html">Login</a>
								<a id="acct-dd-logout-link" class="li-show dropdown-item preserve-page" href="/account/logout.html">Logout</a>
								<a id="acct-dd-settings-link" class="li-show dropdown-item preserve-page" href="/account/settings.html">Account Settings</a>
							</div>
						</li>
					</ul>
				</div>
			</div>
		</nav>
	
	

		<div class="container" id="mainContainer">
			

<div class="row col-lg-12 hidden " id="confirm-box">
	<div class="box w-100">
		<div class="col-lg-12">
			<h2 class="primary-heading">Confirm Synchronization</h2>

			<p>This action may take a few minutes and you will not be able to leave the page until it is done.</p>
			<button class="btn btn-danger btn-block">Update Account Data</button>

		</div>
	</div>
</div>
<div class="row col-lg-12 hidden " id="verify-box">
	<div class="box w-100">
		<div class="col-lg-12">
			<h2 class="primary-heading">Verify Your Email First!</h2>

			<p>Before you may synchronize your account you must verify your email.</p>

		</div>
	</div>
</div>
<div class="row col-lg-12 hidden " id="notfound-box">
	<div class="box w-100">
		<div class="col-lg-12">
			<h2 class="primary-heading">Email not found in directory!</h2>

			<p>Your account email was not found in the T485 Directory.
				Please change your email on the directory (email the webmaster to get the link) or
				<a href="/account/settings.html#changeemail">update your email for your account</a>.</p>
			<br>
			<p class="text-muted text-center">This extra security step is taken to ensure that accounts belong only to members of T485.
				If you believe this was a mistake, please contact the webmaster.</p>

		</div>
	</div>
</div>
<div class="row col-lg-12" id="loading-box">
	<div class="box w-100">
		<div class="col-lg-12">
			<h2 class="primary-heading">Gathering account information</h2>

			<p>Please wait while we load your account information...</p>

		</div>
	</div>
</div>


		</div>
	
	
	<div class="container hidden" id="unexpectederror">

		<div class="row">
			<div class="box">
				<div class="col-lg-12">
					<h2 class="error">An Unexpected Error Occured</h2>


					<p>Please report this bug or try again in a few minutes. <b>Code <span id="unexpectederror-code">UNKNOWN_ERR</span></b></p>

				</div>
			</div>
		</div>
	</div>
	
	

		<footer class="footer text-faded text-center py-5">
			<div class="container">
				<p class="m-0 small">Copyright &copy; 2006-2018 Troop 485, Silicon Valley Monterey Bay Council,
					Boy Scouts of America.</p>
			</div>
		</footer>
	
	
		<div id="feedback">
			<button class="feedback btn btn-primary-outline">Feedback</button>
		</div>

	


	
		<script src="https://www.gstatic.com/firebasejs/5.5.3/firebase-app.js">
		</script>
		<script src="https://www.gstatic.com/firebasejs/5.5.3/firebase-auth.js">
		</script>
		<script src="https://www.gstatic.com/firebasejs/5.5.3/firebase-database.js">
		</script>
		<script src="https://www.gstatic.com/firebasejs/5.5.3/firebase-storage.js">
		</script>
		<!-- <script src="https://www.gstatic.com/firebasejs/5.5.3/firebase-firestore.js"></script> -->
		<!-- <script src="https://www.gstatic.com/firebasejs/5.5.3/firebase-messaging.js"></script> -->
		<!-- <script src="https://www.gstatic.com/firebasejs/5.5.3/firebase-functions.js"></script> -->

		<script>
			// Initialize Firebase
			var config = {
				apiKey: "AIzaSyB-ly8ax35aWTAGhX2UDVuYxPSDlAU8kMk",
				authDomain: "t485-main.firebaseapp.com",
				databaseURL: "https://t485-main.firebaseio.com",
				projectId: "t485-main",
				storageBucket: "t485-main.appspot.com",
				messagingSenderId: "368513727602"
			};
			firebase.initializeApp(config);
		</script>
	
	
		<!-- Bootstrap core JavaScript -->

		<script src="/js/jquery.min.js">
		</script>
		<script src="/js/popper.min.js">
		</script>
		<script src="/js/bootstrap.min.js">
		</script>
		<script src="/js/t485.js">
		</script>
	
	
<script>

	firebase.auth().onAuthStateChanged(function(user) {
		if (user) {
			if (!user.emailVerified) {
				$("#loading-box").addClass("hidden");
				$("#verify-box").removeClass("hidden");
				//console.log("hi");
			} else {
				$("#error").html("");
				firebase.database().ref("/directory/keys/").once("value").then(function(snapshot){
					var keys = snapshot.val();
					$(".link-google-sheet-dir").attr("href", `https://docs.google.com/spreadsheets/d/${keys.id}/edit`);

					rangeString = ``;
					for (i = 0; i < keys.sheets.length; i ++) {
						rangeString += `ranges=${keys.sheets[i]}!A2:U&`
					}

					var UserType = Object.freeze({"STUDENT":1, "FATHER":2, "MOTHER":3});
					console.log(1)
					$.ajax({
						url:`https://sheets.googleapis.com/v4/spreadsheets/${keys.id}/values:batchGet/?${rangeString}majorDimension=ROWS&valueRenderOption=FORMATTED_VALUE&key=${keys.api}`,
						method:"GET",
						dataType:"json"
					}).done(function(data){
						$("#loading-text").addClass("hidden");
						var ranges = data.valueRanges;
						var scoutArrayKeymap = [["scout", "firstName"], ["scout", "lastName"], ["scout", "email"], ["scout", "homePhone"], ["scout", "slack"], ["scout", "job"], ["scout", "joinDate"], ["scout", "active"], ["scout", "WFATrained"], ["scout", "school"], ["scout", "cellPhone"],
							["father", "firstName"], ["father", "lastName"], ["father", "cellPhone"], ["father", "email"], ["father", "slack"],
							["mother", "firstName"], ["mother", "lastName"], ["mother", "cellPhone"], ["mother", "email"], ["mother", "slack"]];
						var scouts = [];
						var row = 0;
						//loop through patrols
						for (i = 0; i < ranges.length; i ++) {
							var values = ranges[i].values;
							var patrol = keys.sheets[i];
							var found = false;
							//loop within patrols
							for (j = 0; j < values.length; j ++) {
								//console.log(values[j]);

								if (values[j][2] == user.email) {
									handleUserData(values[j], user, 1);
									found = true;
								} else if (values[j][14] == user.email) {

									handleUserData(values[j], user, 2);
									found = true;
								} else if (values[j][19] == user.email) {

									handleUserData(values[j], user, 3);
									found = true;
								}
							}

							if (!found) {
								$("#loading-box").addClass("hidden");
								$("#notfound-box").removeClass("hidden");
							}

						}


					});

				});

			}
		} else {
			window.location.href = "/account/login.html";
		}
	});
	function handleUserData(data, user, type) {
		console.log(data);
		console.log(type);
	}

</script>

	 
</body>
